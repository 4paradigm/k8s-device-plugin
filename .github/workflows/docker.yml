name: docker

on:
  push:
    branches:
      - master
#    tags:
#      - v[0-9]+.[0-9]+.[0-9]+.[0-9]

jobs:
  docker:
    runs-on: ubuntu-latest
    steps:
      - uses: olegtarasov/get-tag@v2.1
        id: tagName
#      - name: Login to DockerHub
#        uses: docker/login-action@v1
#        with:
#          username: ${{ secrets.DOCKERHUB_USERNAME }}
#          password: ${{ secrets.DOCKERHUB_TOKEN }}
      - name: Build and push Docker images
        uses: docker/build-push-action@v2.4.0
        with:
          build-args: |
            GOLANG_VERSION=1.15.8
            PLUGIN_VERSION=${{ steps.tagName.outputs.tag }}
          file: docker/Dockerfile.ubuntu20.04
          push: true
          tags: |
            4pdosc/k8s-device-plugin:${{ steps.tagName.outputs.tag }}
            4pdosc/k8s-device-plugin:latest
